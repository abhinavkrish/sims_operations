set_default
	ltype 0
	ptype 0 0
	lweight 0
	ctype black
	lines 0 0

plot_panel 2
	# Makes one plot (Aitoff projection) for one column of data
	# Arguments: ($1,$2)=(filename, column)
	ctype black
	angle 0
        define  word   "epochs"
        define    col     ($2)
        if ( $2 == 3 ) { define  band  "r" }
        if ( $2 == 4 ) { define  band  "g" }
        if ( $2 == 5 ) { define  band  "b" }
        if ( $2 == 6 ) { define  band  "i" }
        if ( $2 == 65 ) {
          define  band  "z"
          define  col   (6)
        }
        if ( $2 == 7 ) {
          define  band  "NEA"
          define  word  "sequences"
        }
        lim -3.0 3.0 -2.1 1.8
        define   fw     (1.5)
        da $1 read { r 1 d 2 n $!!col }
        set r = r*15.0          # RA was in hours, now in degrees
        sort { n r d }
	# Convert RA to range [-180,180]
        set r = (r > 180.0) ? r-360.0 : r
        do i = 0, dimen(r)-1 {
	  docir $(r[$i]) $(d[$i]) $fw $(n[$i])
        }
        ctype black
        if ( $2 != 7 ) { aitoff }
        if ( $2 == 7 ) { aitoff_e }
        angle 0
        relocate -1.2 1.51 label \t{Sky Coverage ($band)}
        return

lsst 1  # Make a plot of expected LSST coverage (multiple panels)
	# Argument: ($1) = (filename)
	erase
	### Define color vector for regular plots
	set col_vec = {20 40 60 80 100}
        location 0 16383 23400 32767
        plot_panel $1 3
        location 16384 32767 23400 32767
        plot_panel $1 4
        location 8191 24574 22560 24900
        leglab 3
        location 0 16383 13000 22362   
        plot_panel $1 5  
        location 16384 32767 13000 22362
        plot_panel $1 6   
        location 0 16383 4840 14202
        plot_panel $1 65
        location 16384 32767 4840 14202
	# Redefine color vector for NEA plot
	set col_vec = {6 12 18 24 30}
        plot_panel $1 7
        location 16384 32600 3660 6000
        leglab 7
        return

leglab 1
	# Makes a legend box, with current color vector
	lim -3 3 -2.10 -1.55
	box 3 3 3 3
        angle 45
	if ( $1 == 7 ) { define   word   "sequences" }
	if ( $1 != 7 ) { define   word   "epochs" }
        legbox -2.8 -1.74 -2.4 -1.61 $(col_vec[0]/2)
        legbox -2.8 -1.89 -2.4 -1.76 $(col_vec[0]+1)
        legbox -2.8 -2.04 -2.4 -1.91 $(col_vec[1]+1)
        legbox  0.0 -1.74  0.4 -1.61 $(col_vec[2]+1)
        legbox  0.0 -1.89  0.4 -1.76 $(col_vec[3]+1)
        legbox  0.0 -2.04  0.4 -1.91 $(col_vec[4]+1)
        angle 0
        ctype black
	expand 0.8
        relocate -2.2 -1.72 label \t{1-$(col_vec[0]) $word}
        relocate -2.2 -1.87 label \t{$(col_vec[0]+1)-$(col_vec[1]) $word}
        relocate -2.2 -2.02 label \t{$(col_vec[1]+1)-$(col_vec[2]) $word}
        relocate  0.6 -1.72 label \t{$(col_vec[2]+1)-$(col_vec[3]) $word}
        relocate  0.6 -1.87 label \t{$(col_vec[3]+1)-$(col_vec[4]) $word}
        relocate  0.6 -2.02 label \t{>$(col_vec[4]) $word}
	expand 1

aitoff	# Plot Aitoff projection
	lim -3 3 1 1
	do dec = -90, 90, 30 {
	  parallel $dec lam phi
	  project lam phi x y 1.0
	  con x y
	}
	do ra = -180, 180, 30 {
	  meridian $ra lam phi
	  project lam phi x y 1.0
	  con x y  
	}
	return

aitoff_e
	# plot Aitoff projection + ecliptic plane
        lim -3 3 1 1
        do dec = -90, 90, 30 {
          parallel $dec lam phi
          project lam phi x y 1.0
          con x y
        }
        do ra = -180, 180, 30 {
          meridian $ra lam phi
          project lam phi x y 1.0
          con x y
        }
	#ctype red
	ctype black
	set ra = -180, 180, 1
	set dec = atan(sin(ra*pi/180)*tan(23.43333*pi/180))*180/pi
	project ra dec x y 1.0
	lweight 3
	con x y
	ctype black
	lweight 0
        return


parallel 3
	set $2 = -180, 180
	set $3 = $2*0 + $1
	return

meridian 3
	set $3 = -90, 90
	set $2 = $3*0 + $1
	return

project 5
	set a$0 = $1*pi/180.0
	set d$0 = $2*pi/180.0
	set z$0 = sqrt((1+cos(d$0)*cos(a$0/2.0))*0.5)
	set $3 = 2*cos(d$0)*sin(a$0/2.0)/z$0
	set $4 = sin(d$0)/z$0
	delete a$0
	delete d$0
	delete z$0
	return

dobox 7
	# plots box in Aitoff projection
	# ($3,$4,$5,$6) = (xl, yb, xr, yt)
	set dimen(rb)=5
	set dimen(db)=5
	set rb[0]=$1+$5
	set db[0]=$2+$6
	set rb[1]=$1+$3
        set db[1]=$2+$6
	set rb[2]=$1+$3
        set db[2]=$2+$4
	set rb[3]=$1+$5
        set db[3]=$2+$4
	set rb[4]=$1+$5
        set db[4]=$2+$6
	project rb db x$0 y$0 1.0
	#if ( $7 == 0 ) { ctype white }
	if ( $7 > 0  && $7 < 21 ) { ctype blue }
	if ( $7 > 20 && $7 < 41 ) { ctype cyan }
	if ( $7 > 40 && $7 < 61 ) { ctype green }
	if ( $7 > 60 && $7 < 81 ) { ctype yellow }
	if ( $7 > 80 && $7 < 101) { ctype red }
	if ( $7 > 100 ) { ctype magenta }
	if ( $7 > 0 ) { shade 10 x$0 y$0 }
	#ctype black
        if ( $7 > 0 ) { con x$0 y$0 }
	delete x$0
	delete y$0

docir 4 # plots LSST FOV ("circle") in Aitoff projection  
        # ($3,$4) = (radius,nobs)
	set phi = 0, 360, 30
	set db = $2 + $3*cos(phi*pi/180)
	set rb = $1 - $3*sin(phi*pi/180)/cos(db*pi/180)
        project rb db x$0 y$0 1.0
	if ( $4 > 0 && $4 <= $(col_vec[0])  ) { ctype blue }
        if ( $4 > $(col_vec[0]) && $4 <= $(col_vec[1]) ) { ctype cyan }
        if ( $4 > $(col_vec[1]) && $4 <= $(col_vec[2]) ) { ctype green }
        if ( $4 > $(col_vec[2]) && $4 <= $(col_vec[3]) ) { ctype yellow }
        if ( $4 > $(col_vec[3]) && $4 <= $(col_vec[4]) ) { ctype red }
        if ( $4 > $(col_vec[4]) ) { ctype magenta }
        if ( $4 > 0 ) {
	  shade 10 x$0 y$0
          con x$0 y$0
	}
        delete x$0
        delete y$0

legbox 5
	set dimen(xlb)=5
	set dimen(ylb)=5
	set xlb[0]=$1
	set xlb[1]=$3
	set xlb[2]=$3
	set xlb[3]=$1
	set xlb[4]=$1
	set ylb[0]=$2
	set ylb[1]=$2
	set ylb[2]=$4
	set ylb[3]=$4
	set ylb[4]=$2
	if ( $5 == 0 ) { ctype white }
	if ( $5 > 0 && $5 <= $(col_vec[0])  ) { ctype blue }
        if ( $5 > $(col_vec[0]) && $5 <= $(col_vec[1]) ) { ctype cyan }
        if ( $5 > $(col_vec[1]) && $5 <= $(col_vec[2]) ) { ctype green }
        if ( $5 > $(col_vec[2]) && $5 <= $(col_vec[3]) ) { ctype yellow }
        if ( $5 > $(col_vec[3]) && $5 <= $(col_vec[4]) ) { ctype red }
        if ( $5 > $(col_vec[4]) ) { ctype magenta }
	shade 10 xlb ylb
	con xlb ylb
	delete xlb
	delete ylb
