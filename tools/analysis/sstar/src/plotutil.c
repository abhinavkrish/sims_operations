
void setPGPlotColors(void) {
  // cpgscr(UCOLOR,0.0,1.0,1.0); //u -- cyan
  // cpgscr(GCOLOR,0.0,1.0,0.0); //g -- green
  // cpgscr(RCOLOR,1.0,1.0,0.0); //r -- yellow
  // cpgscr(ICOLOR,1.0,0.0,0.0); //i -- red
  // cpgscr(ZCOLOR,1.0,0.65,0.0); //z -- orange
  // cpgscr(YCOLOR,0.58,0.0,0.83); //y -- dark violet
  cpgscr(UCOLOR,0.58,0.0,0.83); //u -- dark violet
  cpgscr(GCOLOR,0.0,1.0,1.0); //g -- cyan
  cpgscr(RCOLOR,0.0,1.0,0.0); //r -- green
  cpgscr(ICOLOR,1.0,1.0,0.0); //i -- yellow
  cpgscr(ZCOLOR,1.0,0.65,0.0); //z -- orange
  cpgscr(YCOLOR,1.0,0.0,0.0); //y -- red
  cpgscr(DARKGRAY,0.3,0.3,0.3); //grey
  cpgscr(LIGHTGRAY,0.7,0.7,0.7); //grey2
}

// if filename is empty, use the screen
void openPlot(char *plotName) {
  char tmpstr[1024];
  int p;

  if(strlen(plotfileRoot)==0) {
      p = cpgopen("/xwin");
      cpgpap(PLOTSIZE/0.5,0.5);
  }
  else {
    sprintf(tmpstr,"%s_%s.png/png", plotfileRoot, plotName);
    printf("opening file %s_%s.png\n", plotfileRoot, plotName);
    p = cpgopen(tmpstr);
    cpgpap(PLOTSIZE/0.5,0.5);
  }

  setPGPlotColors();
  cpgsch(1.5); // character height
  cpgscf(2);   // set font to roman
  cpgsci(1);
}

void closePlot(void) {
  if(strlen(plotfileRoot)>0) cpgclos();
}


// my version of the colormap wedge
#define TXTFRC (2.5)
#define TXTSEP (2.2)
#define WDGPIX (100)
void mywedg(float xll, float yll, float height, float width,
            float fg, float bg, const char *label) {
  int i;
  float oldch;
  float tr[6] = {0.0,1.0,0.0,0.0,0.0,1.0};
  float wxa, wxb, wya, wyb, vya, vyb, vxa, vxb;
  float xa, xb, ya, yb;
  float xch, ych, ndcsiz;
  float labhigh, newch, wedheight, wdginc, wdgarr[WDGPIX];
  float fg1, bg1;

  cpgbbuf();
   
  // Store the current world and viewport coords and the character height.
  cpgqwin(&wxa, &wxb, &wya, &wyb);
  cpgqvp(0, &xa, &xb, &ya, &yb);
  cpgqch(&oldch);

  // Determine the unit character height in NDC coords.
  cpgsch(1.0);
  cpgqcs(0, &xch, &ych);
  ndcsiz = ych;

  // Convert 'WIDTH' and 'HEIGHT' into viewport units.
  width = width * ndcsiz * oldch;
  height  = height * ndcsiz * oldch;

  // Determine the number of character heights required under the wedge.
  labhigh = TXTSEP;
  if(strlen(label) > 0) labhigh = labhigh + 1.0;

  // Determine and set the character height required to fit the wedge
  // anotation text within the area allowed for it.
  newch = TXTFRC*height / (labhigh*ndcsiz);
  cpgsch(newch);

  // Determine the width of the wedge part of the plot minus the anotation.
  // (NDC units).
  wedheight = height * (1.0-TXTFRC);

  // Use these to determine viewport coordinates for the wedge + annotation.
  vxa = xll;
  vya = yll;
  vxb = xll + width;
  vyb = yll + height;
  
  // Set the viewport for the wedge.
  cpgsvp(vxa, vxb, vya, vyb);

  // Swap FG/BG if necessary to get axis direction right.
  fg1 = MAX(fg,bg);
  bg1 = MIN(fg,bg);

  // Create a dummy wedge array to be plotted.
  wdginc = (fg1-bg1)/(double)(WDGPIX-1);
  for(i=0; i<WDGPIX; i++)  wdgarr[i] = bg1 + i * wdginc;

  // Draw the wedge then change the world coordinates for labelling.
  cpgswin(1.0, (float) WDGPIX, 0.9, 1.1);
  cpgimag(wdgarr, WDGPIX,1, 1,WDGPIX, 1,1, fg,bg, tr);
  cpgswin(bg1,fg1,0.0,1.0);

  // Draw a labelled frame around the wedge.
  cpgbox("bcnst",0.0,0,"bc",0.0,0);

  // Write the units label.
  if(strlen(label) > 0) cpgmtxt("B",TXTSEP,1.0,1.0,label);

  // Reset the original viewport and world coordinates.
  cpgsvp(xa,xb,ya,yb);
  cpgswin(wxa,wxb,wya,wyb);
  cpgsch(oldch);
  cpgebuf();

}

void palette(int type, float contrast, float brightness);

/*
  set up the PGPLOT colormap used in the image plot
  type:
     1 -> grayscale
     2 -> PGPLOT standard colormap
     3 -> MATLAB standard colormap
*/
void palette(int type, float contrast, float brightness)
{
  if(type==1) {
    // BW
    float BWL[3]={0,0.5, 1};
    float BWR[3]={0.0,0,1.0};
    float BWG[3]={0.0,0,1.0};
    float BWB[3]={0.0,0,1.0};
    cpgctab(BWL, BWR, BWG, BWB, 3, contrast, brightness);
  }
  else if(type==2) {
    // color
    float RL[9]={-0.5, 0.0, 0.17, 0.33, 0.50, 0.67, 0.83, 1.0, 1.7};
    float RR[9]={ 0.0, 0.0,  0.0,  0.0,  0.6,  1.0,  1.0, 1.0, 1.0};
    float RG[9]={ 0.0, 0.0,  0.0,  1.0,  1.0,  1.0,  0.6, 0.0, 1.0};
    float RB[9]={ 0.0, 0.3,  0.8,  1.0,  0.3,  0.0,  0.0, 0.0, 1.0};
    cpgctab(RL, RR, RG, RB, 9, contrast, brightness);
  }
  else if(type==3) {
    float JL[256]=
      { 0, 0.0039, 0.0078, 0.0118, 0.0157, 0.0196, 0.0235, 0.0275,
	0.0314, 0.0353, 0.0392, 0.0431, 0.0471, 0.0510, 0.0549, 0.0588,
	0.0627, 0.0667, 0.0706, 0.0745, 0.0784, 0.0824, 0.0863, 0.0902,
	0.0941, 0.0980, 0.1020, 0.1059, 0.1098, 0.1137, 0.1176, 0.1216,
	0.1255, 0.1294, 0.1333, 0.1373, 0.1412, 0.1451, 0.1490, 0.1529,
	0.1569, 0.1608, 0.1647, 0.1686, 0.1725, 0.1765, 0.1804, 0.1843,
	0.1882, 0.1922, 0.1961, 0.2000, 0.2039, 0.2078, 0.2118, 0.2157,
	0.2196, 0.2235, 0.2275, 0.2314, 0.2353, 0.2392, 0.2431, 0.2471,
	0.2510, 0.2549, 0.2588, 0.2627, 0.2667, 0.2706, 0.2745, 0.2784,
	0.2824, 0.2863, 0.2902, 0.2941, 0.2980, 0.3020, 0.3059, 0.3098,
	0.3137, 0.3176, 0.3216, 0.3255, 0.3294, 0.3333, 0.3373, 0.3412,
	0.3451, 0.3490, 0.3529, 0.3569, 0.3608, 0.3647, 0.3686, 0.3725,
	0.3765, 0.3804, 0.3843, 0.3882, 0.3922, 0.3961, 0.4000, 0.4039,
	0.4078, 0.4118, 0.4157, 0.4196, 0.4235, 0.4275, 0.4314, 0.4353,
	0.4392, 0.4431, 0.4471, 0.4510, 0.4549, 0.4588, 0.4627, 0.4667,
	0.4706, 0.4745, 0.4784, 0.4824, 0.4863, 0.4902, 0.4941, 0.4980,
	0.5020, 0.5059, 0.5098, 0.5137, 0.5176, 0.5216, 0.5255, 0.5294,
	0.5333, 0.5373, 0.5412, 0.5451, 0.5490, 0.5529, 0.5569, 0.5608,
	0.5647, 0.5686, 0.5725, 0.5765, 0.5804, 0.5843, 0.5882, 0.5922,
	0.5961, 0.6000, 0.6039, 0.6078, 0.6118, 0.6157, 0.6196, 0.6235,
	0.6275, 0.6314, 0.6353, 0.6392, 0.6431, 0.6471, 0.6510, 0.6549,
	0.6588, 0.6627, 0.6667, 0.6706, 0.6745, 0.6784, 0.6824, 0.6863,
	0.6902, 0.6941, 0.6980, 0.7020, 0.7059, 0.7098, 0.7137, 0.7176,
	0.7216, 0.7255, 0.7294, 0.7333, 0.7373, 0.7412, 0.7451, 0.7490,
	0.7529, 0.7569, 0.7608, 0.7647, 0.7686, 0.7725, 0.7765, 0.7804,
	0.7843, 0.7882, 0.7922, 0.7961, 0.8000, 0.8039, 0.8078, 0.8118,
	0.8157, 0.8196, 0.8235, 0.8275, 0.8314, 0.8353, 0.8392, 0.8431,
	0.8471, 0.8510, 0.8549, 0.8588, 0.8627, 0.8667, 0.8706, 0.8745,
	0.8784, 0.8824, 0.8863, 0.8902, 0.8941, 0.8980, 0.9020, 0.9059,
	0.9098, 0.9137, 0.9176, 0.9216, 0.9255, 0.9294, 0.9333, 0.9373,
	0.9412, 0.9451, 0.9490, 0.9529, 0.9569, 0.9608, 0.9647, 0.9686,
	0.9725, 0.9765, 0.9804, 0.9843, 0.9882, 0.9922, 0.9961, 1.0000};

    float JR[256]=
      {0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
       0.0156, 0.0312, 0.0469, 0.0625, 0.0781, 0.0938, 0.1094, 0.1250,
       0.1406, 0.1562, 0.1719, 0.1875, 0.2031, 0.2188, 0.2344, 0.2500,
       0.2656, 0.2812, 0.2969, 0.3125, 0.3281, 0.3438, 0.3594, 0.3750,
       0.3906, 0.4062, 0.4219, 0.4375, 0.4531, 0.4688, 0.4844, 0.5000,
       0.5156, 0.5312, 0.5469, 0.5625, 0.5781, 0.5938, 0.6094, 0.6250,
       0.6406, 0.6562, 0.6719, 0.6875, 0.7031, 0.7188, 0.7344, 0.7500,
       0.7656, 0.7812, 0.7969, 0.8125, 0.8281, 0.8438, 0.8594, 0.8750,
       0.8906, 0.9062, 0.9219, 0.9375, 0.9531, 0.9688, 0.9844, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 0.9844, 0.9688, 0.9531, 0.9375, 0.9219, 0.9062, 0.8906,
       0.8750, 0.8594, 0.8438, 0.8281, 0.8125, 0.7969, 0.7812, 0.7656,
       0.7500, 0.7344, 0.7188, 0.7031, 0.6875, 0.6719, 0.6562, 0.6406,
       0.6250, 0.6094, 0.5938, 0.5781, 0.5625, 0.5469, 0.5312, 0.5156};

    float JG[256] =
      {0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0.0156, 0.0312, 0.0469, 0.0625, 0.0781, 0.0938, 0.1094, 0.1250,
       0.1406, 0.1562, 0.1719, 0.1875, 0.2031, 0.2188, 0.2344, 0.2500,
       0.2656, 0.2812, 0.2969, 0.3125, 0.3281, 0.3438, 0.3594, 0.3750,
       0.3906, 0.4062, 0.4219, 0.4375, 0.4531, 0.4688, 0.4844, 0.5000,
       0.5156, 0.5312, 0.5469, 0.5625, 0.5781, 0.5938, 0.6094, 0.6250,
       0.6406, 0.6562, 0.6719, 0.6875, 0.7031, 0.7188, 0.7344, 0.7500,
       0.7656, 0.7812, 0.7969, 0.8125, 0.8281, 0.8438, 0.8594, 0.8750,
       0.8906, 0.9062, 0.9219, 0.9375, 0.9531, 0.9688, 0.9844, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 0.9844, 0.9688, 0.9531, 0.9375, 0.9219, 0.9062, 0.8906,
       0.8750, 0.8594, 0.8438, 0.8281, 0.8125, 0.7969, 0.7812, 0.7656,
       0.7500, 0.7344, 0.7188, 0.7031, 0.6875, 0.6719, 0.6562, 0.6406,
       0.6250, 0.6094, 0.5938, 0.5781, 0.5625, 0.5469, 0.5312, 0.5156,
       0.5000, 0.4844, 0.4688, 0.4531, 0.4375, 0.4219, 0.4062, 0.3906,
       0.3750, 0.3594, 0.3438, 0.3281, 0.3125, 0.2969, 0.2812, 0.2656,
       0.2500, 0.2344, 0.2188, 0.2031, 0.1875, 0.1719, 0.1562, 0.1406,
       0.1250, 0.1094, 0.0938, 0.0781, 0.0625, 0.0469, 0.0312, 0.0156,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0};

    float JB[256] =
      {0.5156, 0.5312, 0.5469, 0.5625, 0.5781, 0.5938, 0.6094, 0.6250,
       0.6406, 0.6562, 0.6719, 0.6875, 0.7031, 0.7188, 0.7344, 0.7500,
       0.7656, 0.7812, 0.7969, 0.8125, 0.8281, 0.8438, 0.8594, 0.8750,
       0.8906, 0.9062, 0.9219, 0.9375, 0.9531, 0.9688, 0.9844, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000,
       1.0000, 0.9844, 0.9688, 0.9531, 0.9375, 0.9219, 0.9062, 0.8906,
       0.8750, 0.8594, 0.8438, 0.8281, 0.8125, 0.7969, 0.7812, 0.7656,
       0.7500, 0.7344, 0.7188, 0.7031, 0.6875, 0.6719, 0.6562, 0.6406,
       0.6250, 0.6094, 0.5938, 0.5781, 0.5625, 0.5469, 0.5312, 0.5156,
       0.5000, 0.4844, 0.4688, 0.4531, 0.4375, 0.4219, 0.4062, 0.3906,
       0.3750, 0.3594, 0.3438, 0.3281, 0.3125, 0.2969, 0.2812, 0.2656,
       0.2500, 0.2344, 0.2188, 0.2031, 0.1875, 0.1719, 0.1562, 0.1406,
       0.1250, 0.1094, 0.0938, 0.0781, 0.0625, 0.0469, 0.0312, 0.0156,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0,
       0,      0,      0,      0,      0,      0,      0,      0};
    cpgctab(JL, JR, JG, JB, 256, contrast, brightness);
  }
  else {
    fprintf(stderr,"palette: unknown type %d\n", type);
    exit(1);
  }
}

int __minind, __maxind;
double __maxval, __minval;
void setupImplot(double minval, double maxval) {
  __minval = minval; __maxval = maxval;
  cpgqcir(&__minind, &__maxind);
  palette(3,1.0,0.5);
}

void plotpoint(double x, double y, double val) {
  int pixval;
  pixval = rint((__minind*(__maxval-val) + __maxind*(val-__minval))/
                (__maxval-__minval));
  cpgsci(pixval);
  cpgpt1(x,y,-2);
  cpgsci(1);
}
